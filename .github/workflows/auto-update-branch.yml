name: Auto Update PR Branches

on:
  push:
    branches: [main]

jobs:
  update-prs:
    runs-on: ubuntu-latest
    steps:
      - name: Update all open PR branches
        env:
          GH_TOKEN: ${{ secrets.AUTO_APPROVE_PAT }}
        run: |
          # Get all open PRs that are behind main
          prs=$(gh pr list --repo ${{ github.repository }} --state open --json number,headRefName,mergeStateStatus --jq '.[] | select(.mergeStateStatus == "BEHIND") | .number')

          for pr in $prs; do
            echo "Updating PR #$pr..."
            gh pr update-branch $pr --repo ${{ github.repository }} --rebase || echo "Failed to update PR #$pr"
          done
